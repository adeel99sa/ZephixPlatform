# Railway Enterprise SRE Monitoring Configuration
# This file configures advanced monitoring, alerting, and auto-remediation

alerting:
  referenceErrors:
    enabled: true
    thresholds:
      - severity: critical
        condition: 'rate(reference_not_found[5m]) > 0'
        response: auto-repair
        escalation: immediate
      - severity: warning
        condition: 'rate(deployment_failure[5m]) > 0.1'
        response: investigate
        escalation: within-5m

  deploymentFailures:
    enabled: true
    thresholds:
      - severity: critical
        condition: 'deployment_success_rate < 0.8'
        response: auto-rollback
        escalation: immediate
      - severity: warning
        condition: 'deployment_success_rate < 0.95'
        response: alert
        escalation: within-10m

  healthCheckFailures:
    enabled: true
    thresholds:
      - severity: critical
        condition: 'health_check_failure_rate > 0.2'
        response: auto-restart
        escalation: immediate
      - severity: warning
        condition: 'health_check_failure_rate > 0.05'
        response: alert
        escalation: within-5m

remediation:
  autoRepair:
    referenceResolution: true
    timeout: 10m
    maxAttempts: 3
    backoffStrategy: exponential

  autoRollback:
    enabled: true
    trigger: deployment_failure
    threshold: 3
    timeout: 5m

  autoRestart:
    enabled: true
    trigger: health_check_failure
    threshold: 5
    timeout: 2m

monitoring:
  metrics:
    - deployment_success_rate
    - deployment_duration
    - health_check_response_time
    - service_uptime
    - error_rate
    - reference_resolution_time

  dashboards:
    - name: "Deployment Overview"
      refresh: 30s
      panels:
        - deployment_success_rate
        - deployment_duration
        - active_deployments
    - name: "Service Health"
      refresh: 15s
      panels:
        - health_check_status
        - service_uptime
        - error_rate
    - name: "Reference Resolution"
      refresh: 1m
      panels:
        - reference_resolution_time
        - reference_errors
        - build_context_validation

  alerting:
    channels:
      - type: slack
        webhook: ${SLACK_WEBHOOK_URL}
        severity: [critical, warning]
      - type: email
        recipients: ${SRE_TEAM_EMAIL}
        severity: [critical]
      - type: pagerduty
        service_key: ${PAGERDUTY_SERVICE_KEY}
        severity: [critical]

sla:
  deployment:
    target: 99.9%
    measurement: success_rate
    window: 24h
  
  health:
    target: 99.95%
    measurement: uptime
    window: 24h
  
  reference_resolution:
    target: 100%
    measurement: success_rate
    window: 1h

maintenance:
  windows:
    - name: "Low Traffic Window"
      schedule: "0 2 * * *"  # 2 AM daily
      duration: 2h
      allowed_actions: [deploy, restart]
  
  procedures:
    emergency_deployment:
      approval: required
      approvers: [senior-sre, engineering-manager]
      timeout: 15m
    
    service_recreation:
      approval: required
      approvers: [senior-sre, devops-lead]
      timeout: 30m
      backup: required
